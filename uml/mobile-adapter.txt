@startuml Adapter

abstract class Operator {
    # constructor(stream : DappInteractionStream) : this
    - _streams : DappInteractionStream
    - setUpStreams(stream : DappInteractionStream) : void
    # handleRequestMessage(data : String) : void
    - {abstract} handleRequest(request : IDappRequestWrapper) : void
    # {abstract} publishEvents(eventMessage : EventMessage) : void
}

class MobileAdapter extends Operator {
    + constructor(stream : MobileInteractionStream) : this
    + handleReactNativeRequest(event : NativeEvent) : Promise<any>
    # handleRequest(request : IDappRequestWrapper) : void
    # publishEvents(eventMessage : EventMessage) : void
}

abstract class DappInteractionStream {
    + {abstract} _write(chunk : any, encoding : string, callback : Function) : void
}

class MobileInteractionStream extends DappInteractionStream {
    - webViewRef : WebView
    + constructor(webViewRef : WebView) : this
    + _write(chunk : any, encoding : string, callback : Function) : void
}

class WebView {
    + injectJavaScript(script : string) : void
    + onMessage(event : NativeEvent) : Promise<any>
}

interface EventMessage {
    + eventName : string
    + params : any
}

interface IDappRequestWrapper {
    + eventId : string
    + params : IDappRequestArguments
}

interface IDappRequestArguments {
    + method : string
    + payload : any
}

note bottom of WebView
    const adapter:MobileAdapter = useRef<MobileAdapter>(new MobileAdapter(new MobileInteractionStream(webViewRef)));
    WebView.onMessage={adapter.current.handleReactNativeRequest}
end note

note left of MobileInteractionStream
    _write=(chunk, encoding, callback)=>{
        webViewRef.injectJavaScript(JSON.stringify(chunk));
        callback();
    }
end note

note right of Operator
    handleRequestMessage=(data)=>{
        ...
        const result=this.handleRequest(request);
        this._streams.push(result);
    }
end note

WebView "1" --> "1" MobileAdapter
MobileAdapter "1" --> "1" MobileInteractionStream
Operator --> EventMessage
MobileInteractionStream "1" --> "1" WebView
Operator "1" --> "1" DappInteractionStream
IDappRequestWrapper "1" --> "1" IDappRequestArguments
Operator --> IDappRequestWrapper

@enduml